<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>TXT Auto Reader</title>

        <style>
            body {
                margin: 0;
                background: #0f0f0f;
                color: #eaeaea;
                font-family:
                    system-ui,
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    Roboto,
                    "PingFang SC",
                    "Microsoft YaHei",
                    sans-serif;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .controls {
                padding: 12px;
                background: #1a1a1a;
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                align-items: center;
            }

            button,
            input,
            select {
                background: #2a2a2a;
                color: #eee;
                border: 1px solid #444;
                padding: 6px 10px;
                border-radius: 4px;
            }

            button:hover {
                background: #3a3a3a;
                cursor: pointer;
            }

            .status {
                margin-left: auto;
                font-size: 14px;
                color: #aaa;
            }

            .viewer {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 12px;
                overflow: hidden;
            }

            .history {
                width: 720px;
                max-width: 90vw;
                font-size: 16px;
                line-height: 1.6;
                color: #999;
                text-align: justify;
                background: #111;
                padding: 12px 20px;
                border-radius: 8px;
                opacity: 0.85;
            }

            #reader {
                width: 720px;
                max-width: 90vw;
                min-height: 3em;

                font-size: 22px;
                line-height: 1.9;

                text-align: justify;
                text-justify: inter-ideograph;

                word-break: break-word;
                overflow-wrap: break-word;
                hyphens: auto;

                padding: 28px;
                background: #141414;
                border-radius: 10px;
            }
        </style>
    </head>

    <body>
        <div class="controls">
            <input type="file" id="fileInput" accept=".txt" />
            <button onclick="togglePause()">Pause / Resume</button>
            <button onclick="changeSpeed(10)">Speed +</button>
            <button onclick="changeSpeed(-10)">Speed -</button>

            <!-- ⭐ 字号 -->
            <button onclick="changeFontSize(2)">A+</button>
            <button onclick="changeFontSize(-2)">A-</button>

            <!-- ⭐ 字体 -->
            <select onchange="changeFont(this.value)">
                <option value="system-ui">System</option>
                <option value="'PingFang SC','Microsoft YaHei',sans-serif">
                    中文默认
                </option>
                <option value="serif">Serif</option>
                <option value="'Times New Roman',serif">Times</option>
                <option value="monospace">Monospace</option>
                <option value="'JetBrains Mono',monospace">
                    JetBrains Mono
                </option>
            </select>

            <input
                type="number"
                id="jumpInput"
                placeholder="Jump line"
                style="width: 100px"
            />
            <button onclick="jumpToLine()">Jump</button>

            <div class="status">
                Line <span id="currentLine">0</span> /
                <span id="totalLines">0</span>
            </div>
        </div>

        <div class="viewer">
            <div id="history2" class="history"></div>
            <div id="history1" class="history"></div>
            <div id="reader"></div>
        </div>

        <script>
            /* ===== 状态 ===== */
            let lines = [];
            let lineIndex = 0;
            let charIndex = 0;
            let speed = 60;
            let paused = false;
            let timer = null;

            /* ===== 字体状态 ===== */
            let currentFontSize = 22;
            let currentFontFamily = "system-ui";

            /* ===== DOM ===== */
            const reader = document.getElementById("reader");
            const h1 = document.getElementById("history1");
            const h2 = document.getElementById("history2");
            const currentLineEl = document.getElementById("currentLine");
            const totalLinesEl = document.getElementById("totalLines");

            /* ===== 文件加载 ===== */
            document
                .getElementById("fileInput")
                .addEventListener("change", (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const fr = new FileReader();
                    fr.onload = (ev) => {
                        lines = ev.target.result.split(/\r?\n/);
                        lineIndex = 0;
                        charIndex = 0;
                        paused = false;

                        reader.textContent = "";
                        h1.textContent = "";
                        h2.textContent = "";

                        updateLineStatus();
                        scheduleNext();
                    };
                    fr.readAsText(file);
                });

            /* ===== 打字 ===== */
            function scheduleNext(delay = speed) {
                clearTimeout(timer);
                timer = setTimeout(typeNext, delay);
            }

            function typeNext() {
                if (paused) return;
                if (lineIndex >= lines.length) return;

                const line = lines[lineIndex];

                if (charIndex < line.length) {
                    reader.textContent += line[charIndex];
                    charIndex++;
                    scheduleNext();
                } else {
                    reader.textContent = "";
                    lineIndex++;
                    charIndex = 0;
                    updateHistory();
                    updateLineStatus();
                    scheduleNext(300);
                }
            }

            /* ===== 历史 ===== */
            function updateHistory() {
                h1.textContent = lines[lineIndex - 1] || "";
                h2.textContent = lines[lineIndex - 2] || "";
            }

            /* ===== 控制 ===== */
            function togglePause() {
                paused = !paused;
                if (!paused) scheduleNext();
            }

            function changeSpeed(delta) {
                speed = Math.max(10, speed + delta);
                if (!paused) scheduleNext(speed);
            }

            function jumpToLine() {
                const n = parseInt(document.getElementById("jumpInput").value);
                if (isNaN(n) || n < 1 || n > lines.length) return;

                lineIndex = n - 1;
                charIndex = 0;
                reader.textContent = "";
                updateHistory();
                updateLineStatus();
                if (!paused) scheduleNext(300);
            }

            /* ===== 字号 ===== */
            function changeFontSize(delta) {
                currentFontSize = Math.min(
                    40,
                    Math.max(14, currentFontSize + delta),
                );
                reader.style.fontSize = currentFontSize + "px";
            }

            /* ===== 字体 ===== */
            function changeFont(font) {
                currentFontFamily = font;
                reader.style.fontFamily = font;
                h1.style.fontFamily = font;
                h2.style.fontFamily = font;
            }

            /* ===== 行号 ===== */
            function updateLineStatus() {
                currentLineEl.textContent = lineIndex + 1;
                totalLinesEl.textContent = lines.length;
            }

            /* ===== Space 快捷键 ===== */
            document.addEventListener("keydown", (e) => {
                if (e.target.tagName === "INPUT") return;
                if (e.code === "Space") {
                    e.preventDefault();
                    togglePause();
                }
            });
        </script>
    </body>
</html>
